# 多CLI支持规范文档

## 1. 概述

本文档定义了Stigmergy桌面应用对多种AI CLI工具的支持规范，包括iFlow、Claude、Qwen、Gemini和Codex。

## 2. 支持的CLI工具

### 2.1 Stigmergy CLI
- **核心功能**: 多AI CLI工具协调系统
- **命令结构**: `stigmergy <command> [options]`
- **技能系统**: 完整的技能管理（安装、列表、读取、验证、移除、同步）
- **跨CLI支持**: 内置支持其他CLI工具的调用

### 2.2 Claude CLI
- **核心功能**: Anthropic Claude AI助手
- **命令结构**: `claude [options] [command] [prompt]`
- **技能系统**: 通过MCP（Model Context Protocol）扩展功能
- **特有功能**: 插件系统、会话管理

### 2.3 Qwen CLI
- **核心功能**: 阿里云通义千问AI助手
- **命令结构**: `qwen [options] [command]`
- **技能系统**: 通过MCP和扩展系统支持
- **特有功能**: 扩展管理、多模型支持

### 2.4 iFlow CLI
- **核心功能**: iFlow AI助手
- **命令结构**: `iflow [options] [command]`
- **技能系统**: 代理管理和工作流系统
- **特有功能**: 代理管理、工作流支持

### 2.5 Gemini CLI
- **核心功能**: Google Gemini AI助手
- **命令结构**: `gemini [options] [command]`
- **技能系统**: 通过MCP和扩展系统支持
- **特有功能**: 扩展管理、会话恢复

### 2.6 Codex CLI
- **核心功能**: Codex AI编码助手
- **命令结构**: `codex [options] [command]`
- **技能系统**: 通过MCP服务器支持
- **特有功能**: 代码审查、沙箱执行

## 3. 集成需求

### 3.1 统一接口层
- 为每个CLI工具创建统一的包装器
- 实现命令执行、结果解析和错误处理
- 支持异步操作和进度反馈

### 3.2 技能管理
- 统一技能发现和加载机制
- 支持各CLI工具特有的技能格式
- 实现技能的安装、更新和卸载功能

### 3.3 会话管理
- 统一会话存储和恢复机制
- 支持各CLI工具的会话特性
- 实现跨CLI会话协作

### 3.4 配置管理
- 统一配置界面
- 支持各CLI工具特有的配置项
- 实现配置导入导出功能

## 4. 技术实现要求

### 4.1 进程管理
- 安全的子进程执行
- 资源限制和超时控制
- 输出流实时捕获和解析

### 4.2 数据交换
- 标准化的数据交换格式
- 支持文本和结构化数据
- 错误信息标准化处理

### 4.3 安全性
- CLI命令白名单机制
- 文件系统访问控制
- 权限最小化原则

## 5. 用户界面要求

### 5.1 统一操作界面
- 一致的命令执行界面
- 统一的结果展示方式
- 标准化的错误提示

### 5.2 CLI特定功能
- 保留各CLI工具的特有能力
- 提供CLI专用配置界面
- 支持CLI特有的交互模式

## 6. 测试要求

### 6.1 功能测试
- 每个CLI工具的基本命令执行
- 技能管理功能测试
- 会话管理功能测试

### 6.2 兼容性测试
- 不同操作系统下的兼容性
- 各CLI工具版本兼容性
- 并发操作测试

### 6.3 性能测试
- 命令执行响应时间
- 内存和CPU使用情况
- 大数据量处理能力